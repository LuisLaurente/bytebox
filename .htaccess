# Configuraciones de seguridad para PHP
<IfModule mod_php7.c>
    php_flag session.use_strict_mode On
    php_flag session.use_only_cookies On
    php_flag session.cookie_httponly On
    php_value session.cookie_samesite "Lax"
    php_flag session.cookie_secure Off
</IfModule>

<IfModule mod_php.c>
    php_flag session.use_strict_mode On
    php_flag session.use_only_cookies On
    php_flag session.cookie_httponly On
    php_value session.cookie_samesite "Lax"
    php_flag session.cookie_secure Off
</IfModule>

# Evitar listado de directorios
Options -Indexes

# Proteger archivos sensibles
<FilesMatch "^(\.env|.*\.log|composer\.json|composer\.lock|\.htaccess)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# ==========================================
# REDIRECCIÓN INTELIGENTE A PUBLIC
# ==========================================
RewriteEngine On

# 1. Si es un archivo o directorio existente en public/, servirlo directamente
RewriteCond %{REQUEST_URI} ^/bytebox/public/ [NC]
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2. Para LOCAL: Redirigir /bytebox/* a /bytebox/public/index.php?url=*
RewriteCond %{HTTP_HOST} ^localhost [NC]
RewriteCond %{REQUEST_URI} ^/bytebox/
RewriteCond %{REQUEST_URI} !^/bytebox/public/
RewriteRule ^bytebox/(.*)$ /bytebox/public/index.php?url=$1 [L,QSA]

# 3. Redirigir raíz de local a public/
RewriteCond %{HTTP_HOST} ^localhost [NC]
RewriteRule ^bytebox/?$ /bytebox/public/ [L,R=301]

# 4. Para PRODUCCIÓN: Redirigir /* a /public/index.php?url=*
RewriteCond %{HTTP_HOST} !^localhost [NC]
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule ^(.*)$ /public/index.php?url=$1 [L,QSA]

# 5. Redirigir raíz de producción a public/
RewriteCond %{HTTP_HOST} !^localhost [NC]
RewriteRule ^$ /public/ [L,R=301]